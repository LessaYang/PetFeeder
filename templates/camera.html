{% extends "layout.html" %}
{% block content %}
<div class="card">
  <h2 class="text-xl font-semibold mb-2">Live Camera</h2>
  <p class="mb-4">View your pet in real time below. The camera stream automatically updates when turned on.</p>

  <!-- Stream URL form (optional override) -->
  <form id="urlForm" class="mb-4">
    <label for="streamUrl" class="block text-sm font-medium mb-1">Stream URL</label>
    <input type="text" id="streamUrl" name="streamUrl"
           class="w-full border border-gray-300 rounded px-2 py-1"
           value="http://192.168.1.15:8080/?action=stream">
  </form>

  <!-- Live Stream -->
  <div class="rounded overflow-hidden border border-gray-400 bg-black">
    <img id="stream" src="http://<your_pi_ip>:8080/?action=stream"
         alt="Camera stream"
         class="w-full h-auto block" style="max-height: 480px;">
  </div>

  <!-- Buttons -->
  <div class="flex gap-2 mt-4">
    <button onclick="startCamera()" class="btn">Turn On Camera</button>
    <button onclick="stopCamera()" class="btn bg-red-500 hover:bg-red-600">Turn Off Camera</button>
  </div>
</div>

<script>
  const baseApi = "{{ request.host_url }}api";
  const streamImg = document.getElementById('stream');
  const urlInput = document.getElementById('streamUrl');

  function startCamera() {
    fetch(`${baseApi}/camera/on`, { method: "POST" })
      .then(() => {
        streamImg.src = urlInput.value.trim();
        alert("Camera turned ON");
      })
      .catch(err => console.error("Failed to start camera:", err));
  }

  function stopCamera() {
    fetch(`${baseApi}/camera/off`, { method: "POST" })
      .then(() => {
        streamImg.src = "";
        alert("Camera turned OFF");
      })
      .catch(err => console.error("Failed to stop camera:", err));
  }
</script>
{% endblock %}
